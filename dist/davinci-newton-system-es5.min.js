/*! davinci-newton 2017-01-16 */
System.register("davinci-newton/config.js",[],function(a,b){"use strict";var c,d;b&&b.id;return{setters:[],execute:function(){c=function(){function a(){this.GITHUB="https://github.com/geometryzen/davinci-newton",this.LAST_MODIFIED="2017-01-15",this.NAMESPACE="NEWTON",this.VERSION="0.0.2"}return a.prototype.log=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];console.log(a)},a.prototype.info=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];console.log(a)},a.prototype.warn=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];console.warn(a)},a.prototype.error=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];console.error(a)},a}(),d=new c,a("default",d)}}}),System.register("davinci-newton/engine/RigidBody.js",["../objects/AbstractSimObject","../math/Vector"],function(a,b){"use strict";var c,d,e,f=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)};b&&b.id;return{setters:[function(a){c=a},function(a){d=a}],execute:function(){e=function(a){function b(b){var c=a.call(this,b)||this;return c.varsIndex_=-1,c.x=0,c.y=0,c.z=0,c.vx=0,c.vy=0,c.vz=0,c.angle=0,c.omega_=0,c.mass_=1,c.loc_world_=d["default"].ORIGIN,c.sinAngle_=0,c.cosAngle_=1,c.cm_body_=d["default"].ORIGIN,c}return f(b,a),b.prototype.getExpireTime=function(){return Number.POSITIVE_INFINITY},b.prototype.eraseOldCopy=function(){this.body_old_=null},b.prototype.getVarsIndex=function(){return this.varsIndex_},b.prototype.setVarsIndex=function(a){this.varsIndex_=a},b.prototype.getVarName=function(a,b){switch(a){case 0:return"position x";case 1:return"position y";case 2:return"position z";case 3:return"velocity x";case 4:return"velocity y";case 5:return"velocity z";case 6:return"angle";case 7:return"omega"}throw new Error("getVarName("+a+")")},b.prototype.getAttitude=function(){return this.angle},b.prototype.getAngularVelocity=function(){return this.omega_},b.prototype.getPosition=function(){return new d["default"](this.x,this.y,this.z)},b.prototype.setPosition=function(a,b,c){this.x=a,this.y=b,this.z=c},b.prototype.setAttitude=function(a){this.angle=a,this.cosAngle_=Math.cos(a),this.sinAngle_=Math.sin(a)},b.prototype.getVelocity=function(){return new d["default"](this.vx,this.vy,this.vz)},b.prototype.setVelocity=function(a,b,c){this.vx=a,this.vy=b,this.vz=c},b.prototype.setAngularVelocity=function(a){this.omega_=a},b.prototype.getMass=function(){return this.mass_},b.prototype.momentAboutCM=function(){return 1},b.prototype.rotationalEnergy=function(){return 0},b.prototype.translationalEnergy=function(){return 0},b.prototype.saveOldCopy=function(){},b.prototype.bodyToWorld=function(a){var b=a.getX()-this.cm_body_.getX(),c=a.getY()-this.cm_body_.getY(),e=this.loc_world_.getX()+(b*this.cosAngle_-c*this.sinAngle_),f=this.loc_world_.getY()+(b*this.sinAngle_+c*this.cosAngle_);return new d["default"](e,f,0)},b.prototype.worldVelocityOfBodyPoint=function(a){var b=this.rotateBodyToWorld(a.immutable().subtract(this.cm_body_)),c=this.vx-b.getY()*this.omega_,e=this.vy+b.getX()*this.omega_;return new d["default"](c,e,0)},b.prototype.rotateBodyToWorld=function(a){return a.immutable().rotate(this.cosAngle_,this.sinAngle_)},b}(c["default"]),a("RigidBody",e),a("default",e)}}}),System.register("davinci-newton/model/EnergyInfo.js",[],function(a,b){"use strict";var c;b&&b.id;return{setters:[],execute:function(){c=function(){function a(a,b,c){}return a.prototype.getPotential=function(){return 0},a.prototype.getTranslational=function(){return 0},a.prototype.getRotational=function(){return 0},a.prototype.getTotalEnergy=function(){return 0},a}(),a("EnergyInfo",c),a("default",c)}}}),System.register("davinci-newton/util/remove.js",[],function(a,b){"use strict";function c(a,b){throw new Error("TODO: remove")}b&&b.id;return a("default",c),{setters:[],execute:function(){}}}),System.register("davinci-newton/util/contains.js",[],function(a,b){"use strict";function c(a,b){for(var c=a.length,d=0;d<c;d++)if(a[d]===b)return!0;return!1}b&&b.id;return a("default",c),{setters:[],execute:function(){}}}),System.register("davinci-newton/checks/mustSatisfy.js",[],function(a,b){"use strict";function c(a,b,c,d){if(!b){var e=c?c():"satisfy some condition",f=d?" in "+d():"";throw new Error(a+" must "+e+f+".")}}b&&b.id;return a("default",c),{setters:[],execute:function(){}}}),System.register("davinci-newton/checks/isNull.js",[],function(a,b){"use strict";function c(a){return null===a}b&&b.id;return a("default",c),{setters:[],execute:function(){}}}),System.register("davinci-newton/checks/isObject.js",[],function(a,b){"use strict";function c(a){return"object"==typeof a}b&&b.id;return a("default",c),{setters:[],execute:function(){}}}),System.register("davinci-newton/checks/mustBeNonNullObject.js",["../checks/mustSatisfy","../checks/isNull","../checks/isObject"],function(a,b){"use strict";function c(){return"be a non-null `object`"}function d(a,b,d){return e["default"](a,g["default"](b)&&!f["default"](b),c,d),b}b&&b.id;a("default",d);var e,f,g;return{setters:[function(a){e=a},function(a){f=a},function(a){g=a}],execute:function(){}}}),System.register("davinci-newton/core/SimList.js",["../util/AbstractSubject","../util/contains","../util/GenericEvent","../checks/mustBeNonNullObject"],function(a,b){"use strict";var c,d,e,f,g,h=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)};b&&b.id;return{setters:[function(a){c=a},function(a){d=a},function(a){e=a},function(a){f=a}],execute:function(){g=function(a){function b(){var b=a.call(this,"SIM_LIST")||this;return b.elements_=[],b}return h(b,a),b.prototype.add=function(a){for(var c=0;c<arguments.length;c++){var g=arguments[c];f["default"]("element",g),d["default"](this.elements_,g)||(this.elements_.push(g),this.broadcast(new e["default"](this,b.OBJECT_ADDED,g)))}},b.prototype.remove=function(a){throw new Error("TODO")},b.prototype.removeTemporary=function(a){for(var c=this.elements_.length-1;c>=0;c--){var d=this.elements_[c];d.getExpireTime()<a&&(this.elements_.splice(c,1),this.broadcast(new e["default"](this,b.OBJECT_REMOVED,d)))}},b}(c["default"]),g.OBJECT_ADDED="OBJECT_ADDED",g.OBJECT_REMOVED="OBJECT_REMOVED",a("SimList",g),a("default",g)}}}),System.register("davinci-newton/model/ConcreteVariable.js",["../util/toName","../util/validName"],function(a,b){"use strict";var c,d,e;b&&b.id;return{setters:[function(a){c=a},function(a){d=a}],execute:function(){e=function(){function a(a,b,e){this.varsList_=a,this.localName_=e,this.value_=0,this.seq_=0,this.doesBroadcast_=!1,this.name_=d["default"](c["default"](b))}return a.prototype.getName=function(a){return a?this.localName_:this.name_},a.prototype.getSubject=function(){return this.varsList_},a.prototype.getValue=function(){return this.value_},a.prototype.setValue=function(a){this.value_!==a&&(this.value_=a,this.seq_++,this.doesBroadcast_&&this.varsList_.broadcast(this))},a.prototype.setValueSmooth=function(a){this.value_=a},a.prototype.incrSequence=function(){this.seq_++},a}(),a("ConcreteVariable",e),a("default",e)}}}),System.register("davinci-newton/checks/isArray.js",[],function(a,b){"use strict";function c(a){return"[object Array]"===Object.prototype.toString.call(a)}b&&b.id;return a("default",c),{setters:[],execute:function(){}}}),System.register("davinci-newton/util/extendArray.js",["../checks/isArray"],function(a,b){"use strict";function c(a,b,c){if(0!==b){if(b<0)throw new Error;var e=a.length;if(a.length=e+b,d["default"](c)){var f=c;if(f.length!==b)throw new Error;for(var g=e,h=a.length;g<h;g++)a[g]=c[g-e]}else for(var g=e,h=a.length;g<h;g++)a[g]=c}}b&&b.id;a("default",c);var d;return{setters:[function(a){d=a}],execute:function(){}}}),System.register("davinci-newton/checks/isString.js",[],function(a,b){"use strict";function c(a){return"string"==typeof a}b&&b.id;return a("default",c),{setters:[],execute:function(){}}}),System.register("davinci-newton/core/VarsList.js",["../util/AbstractSubject","../model/ConcreteVariable","../util/extendArray","../util/GenericEvent","../checks/isString","../util/toName","../util/validName"],function(a,b){"use strict";var c,d,e,f,g,h,i,j,k=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)};b&&b.id;return{setters:[function(a){c=a},function(a){d=a},function(a){e=a},function(a){f=a},function(a){g=a},function(a){h=a},function(a){i=a}],execute:function(){j=function(a){function b(c,e,f){void 0===f&&(f="VARIABLES");var j=a.call(this,f)||this;if(j.timeIdx_=-1,j.varList_=[],c.length!==e.length)throw new Error("varNames and localNames are different lengths");for(var k=0,l=c.length;k<l;k++){var m=c[k];if(!g["default"](m))throw new Error("variable name "+m+" is not a string i="+k);m=i["default"](h["default"](m)),c[k]=m,m===b.TIME&&(j.timeIdx_=k)}for(var k=0,l=c.length;k<l;k++)j.varList_.push(new d["default"](j,c[k],e[k]));return j}return k(b,a),b.prototype.findOpenSlot_=function(a){for(var c=0,f=-1,g=0,h=this.varList_.length;g<h;g++)if(this.varList_[g].getName()===b.DELETED){if(f===-1&&(f=g),c++,c>=a)return f}else f=-1,c=0;var i;c>0?i=a-c:(f=this.varList_.length,i=a);var j=[];for(g=0;g<i;g++)j.push(new d["default"](this,b.DELETED,b.DELETED));return e["default"](this.varList_,i,j),f},b.prototype.addVariables=function(a,c){var e=a.length;if(0===e)throw new Error;if(a.length!==c.length)throw new Error("names and localNames are different lengths");for(var g=this.findOpenSlot_(e),j=0;j<e;j++){var k=i["default"](h["default"](a[j]));if(k===b.DELETED)throw new Error("variable cannot be named ''+VarsList.DELETED+''");var l=g+j;this.varList_[l]=new d["default"](this,k,c[j]),k===b.TIME&&(this.timeIdx_=l)}return this.broadcast(new f["default"](this,b.VARS_MODIFIED)),g},b.prototype.deleteVariables=function(a,b){throw new Error("TODO")},b.prototype.incrSequence=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];if(0===arguments.length)for(var c=0,d=this.varList_.length;c<d;c++)this.varList_[c].incrSequence();else for(var c=0,d=arguments.length;c<d;c++){var e=arguments[c];this.checkIndex_(e),this.varList_[e].incrSequence()}},b.prototype.getValue=function(a){return this.checkIndex_(a),this.varList_[a].getValue()},b.prototype.getValues=function(){return this.varList_.map(function(a){return a.getValue()})},b.prototype.setValues=function(a,b){void 0===b&&(b=!1);var c=this.varList_.length,d=a.length;if(d>c)throw new Error("setValues bad length n = "+d+" > N = "+c);for(var e=0;e<c;e++)e<d&&this.setValue(e,a[e],b)},b.prototype.setValue=function(a,b,c){void 0===c&&(c=!1),this.checkIndex_(a);var d=this.varList_[a];if(isNaN(b))throw new Error("cannot set variable "+d.getName()+" to NaN");c?d.setValueSmooth(b):d.setValue(b)},b.prototype.getTime=function(){if(this.timeIdx_<0)throw new Error("no time variable");return this.getValue(this.timeIdx_)},b.prototype.timeIndex=function(){return this.timeIdx_},b.prototype.checkIndex_=function(a){if(a<0||a>=this.varList_.length)throw new Error("bad variable index="+a+"; numVars="+this.varList_.length)},b}(c["default"]),j.DELETED="DELETED",j.TIME="TIME",j.VARS_MODIFIED="VARS_MODIFIED",a("VarsList",j),a("default",j)}}}),System.register("davinci-newton/engine/RigidBodySim.js",["../util/AbstractSubject","../util/contains","../model/EnergyInfo","../util/remove","../core/SimList","../core/VarsList"],function(a,b){"use strict";var c,d,e,f,g,h,i,j,k,l,m=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)};b&&b.id;return{setters:[function(a){c=a},function(a){d=a},function(a){e=a},function(a){f=a},function(a){g=a},function(a){h=a}],execute:function(){i=["time","kinetic enetry","potential energy","total energy"],j=["time","kinetic enetry","potential energy","total energy"],k=8,l=function(a){function b(b){void 0===b&&(b="SIM");var c=a.call(this,b)||this;return c.simList_=new g["default"],c.bods_=[],c.forceLaws_=[],c.varsList_=new h["default"](i,j,c.getName()+"_VARS"),c}return m(b,a),b.prototype.addBody=function(a){if(!d["default"](this.bods_,a)){for(var b=[],c=0;c<k;c++)b.push(a.getVarName(c,!1));for(var e=[],c=0;c<k;c++)e.push(a.getVarName(c,!0));var f=this.varsList_.addVariables(b,e);a.setVarsIndex(f),this.bods_.push(a),this.getSimList().add(a)}this.initializeFromBody(a),this.bods_.forEach(function(a){a.eraseOldCopy()})},b.prototype.removeBody=function(a){d["default"](this.bods_,a)&&(this.varsList_.deleteVariables(a.getVarsIndex(),k),f["default"](this.bods_,a),a.setVarsIndex(-1)),this.getSimList().remove(a),this.getVarsList().incrSequence(1,2,3)},b.prototype.addForceLaw=function(a){d["default"](this.forceLaws_,a)||this.forceLaws_.push(a),this.getVarsList().incrSequence(1,2,3)},b.prototype.removeForceLaw=function(a){return a.disconnect(),this.getVarsList().incrSequence(1,2,3),f["default"](this.forceLaws_,a)},b.prototype.moveObjects=function(a){this.bods_.forEach(function(c){var d=c.getVarsIndex();if(!(d<0)){var e=a[d+b.X_],f=a[d+b.Y_],g=a[d+b.Z_];c.setPosition(e,f,g),c.setAttitude(a[d+b.W_]);var h=a[d+b.VX_],i=a[d+b.VY_],j=a[d+b.VZ_];c.setVelocity(h,i,j),c.setAngularVelocity(a[d+b.VW_])}})},b.prototype.evaluate=function(a,c,d){var e=this;return this.moveObjects(a),this.bods_.forEach(function(d){var e=d.getVarsIndex();if(!(e<0)){var f=d.getMass();if(f===Number.POSITIVE_INFINITY)for(var g=0;g<k;g++)c[e+g]=0;else c[e+b.X_]=a[e+b.VX_],c[e+b.Y_]=a[e+b.VY_],c[e+b.Z_]=a[e+b.VZ_],c[e+b.W_]=a[e+b.VW_],c[e+b.VX_]=0,c[e+b.VY_]=0,c[e+b.VZ_]=0,c[e+b.VW_]=0}}),this.forceLaws_.forEach(function(a){var b=a.calculateForces();b.forEach(function(a){e.applyForce(c,a)})}),c[this.varsList_.timeIndex()]=1,null},b.prototype.applyForce=function(a,c){var e=c.getBody();if(d["default"](this.bods_,e)){var f=e,g=f.getVarsIndex();if(!(g<0)){var h=c.getVector(),i=c.getStartPoint(),j=f.getMass();a[g+b.VX_]+=h.getX()/j,a[g+b.VY_]+=h.getY()/j,a[g+b.VZ_]+=h.getZ()/j;var k=f.getPosition(),l=i.getX()-k.x,m=i.getY()-k.y;a[g+b.VW_]+=(l*h.getY()-m*h.getX())/f.momentAboutCM();var n=c.getTorque();0!==n&&(a[g+b.VW_]+=n/f.momentAboutCM()),this.showForces_&&(c.setExpireTime(this.getTime()),this.getSimList().add(c))}}},b.prototype.getTime=function(){return this.varsList_.getTime()},b.prototype.initializeFromBody=function(a){a.eraseOldCopy();var c=a.getVarsIndex();if(c>-1){var d=this.varsList_,e=a.getPosition();d.setValue(b.X_+c,e.x),d.setValue(b.Y_+c,e.y),d.setValue(b.Z_+c,e.z),d.setValue(b.W_+c,a.getAttitude());var f=a.getVelocity();d.setValue(b.VX_+c,f.x),d.setValue(b.VY_+c,f.y),d.setValue(b.VZ_+c,f.z),d.setValue(b.VW_+c,a.getAngularVelocity())}this.getVarsList().incrSequence(1,2,3)},b.prototype.modifyObjects=function(){var a=this.varsList_,b=a.getValues();this.moveObjects(b);var c=this.getEnergyInfo_(b);a.setValue(1,c.getTranslational()+c.getRotational(),!0),a.setValue(2,c.getPotential(),!0),a.setValue(3,c.getTotalEnergy(),!0)},b.prototype.getSimList=function(){return this.simList_},b.prototype.getVarsList=function(){return this.varsList_},b.prototype.getEnergyInfo_=function(a){var b=0,c=0,d=0;return this.bods_.forEach(function(a){isFinite(a.getMass())&&(c+=a.rotationalEnergy(),d+=a.translationalEnergy())}),this.forceLaws_.forEach(function(a){b+=a.getPotentialEnergy()}),new e["default"](b+this.potentialOffset_,d,c)},b.prototype.saveState=function(){this.recentState_=this.varsList_.getValues(),this.bods_.forEach(function(a){a.saveOldCopy()})},b.prototype.restoreState=function(){null!=this.recentState_&&this.varsList_.setValues(this.recentState_,!0),this.bods_.forEach(function(a){a.eraseOldCopy()})},b.prototype.findCollisions=function(a,b,c){throw new Error("TODO: findCollisions")},b}(c["default"]),l.X_=0,l.Y_=1,l.Z_=2,l.VX_=3,l.VY_=4,l.VZ_=5,l.W_=6,l.VW_=7,a("default",l)}}}),System.register("davinci-newton/util/zeroArray.js",[],function(a,b){"use strict";function c(a){for(var b=a.length,c=0;c<b;c++)a[c]=0}b&&b.id;return a("default",c),{setters:[],execute:function(){}}}),System.register("davinci-newton/model/RungeKutta.js",["../util/zeroArray"],function(a,b){"use strict";var c,d;b&&b.id;return{setters:[function(a){c=a}],execute:function(){d=function(){function a(a){this.ode_=a,this.inp_=[],this.k1_=[],this.k2_=[],this.k3_=[],this.k4_=[]}return a.prototype.step=function(a){var b,d,e=this.ode_.getVarsList(),f=e.getValues(),g=f.length;this.inp_.length<g&&(this.inp_=new Array(g),this.k1_=new Array(g),this.k2_=new Array(g),this.k3_=new Array(g),this.k4_=new Array(g));var h=this.inp_,i=this.k1_,j=this.k2_,k=this.k3_,l=this.k4_;for(d=0;d<g;d++)h[d]=f[d];if(c["default"](i),b=this.ode_.evaluate(h,i,0),null!==b)return b;for(d=0;d<g;d++)h[d]=f[d]+i[d]*a/2;if(c["default"](j),b=this.ode_.evaluate(h,j,a/2),null!==b)return b;for(d=0;d<g;d++)h[d]=f[d]+j[d]*a/2;if(c["default"](k),b=this.ode_.evaluate(h,k,a/2),null!==b)return b;for(d=0;d<g;d++)h[d]=f[d]+k[d]*a;if(c["default"](l),b=this.ode_.evaluate(h,l,a),null!==b)return b;for(d=0;d<g;d++)f[d]+=(i[d]+2*j[d]+2*k[d]+l[d])*a/6;return e.setValues(f,!0),null},a}(),a("RungeKutta",d),a("default",d)}}}),System.register("davinci-newton/strategy/SimpleAdvance.js",[],function(a,b){"use strict";var c;b&&b.id;return{setters:[],execute:function(){c=function(){function a(a,b){this.sim_=a,this.odeSolver_=b,this.timeStep_=.025}return a.prototype.advance=function(a,b){this.sim_.getSimList().removeTemporary(this.sim_.getTime());var c=this.odeSolver_.step(a);if(null!=c)throw new Error("error during advance "+c);this.sim_.modifyObjects(),void 0!==b&&b.memorize()},a.prototype.getTime=function(){return this.sim_.getTime()},a.prototype.getTimeStep=function(){return this.timeStep_},a}(),a("SimpleAdvance",c),a("default",c)}}}),System.register("davinci-newton/util/AbstractSubject.js",["../util/toName","../util/validName"],function(a,b){"use strict";var c,d,e;b&&b.id;return{setters:[function(a){c=a},function(a){d=a}],execute:function(){e=function(){function a(a){if(this.doBroadcast_=!0,this.observers_=[],!a)throw new Error("no name");this.name_=d["default"](c["default"](a))}return a.prototype.getName=function(){return this.name_},a.prototype.broadcast=function(a){if(this.doBroadcast_)for(var b=this.observers_.length,c=0;c<b;c++)this.observers_[c].observe(a)},a}(),a("AbstractSubject",e),a("default",e)}}}),System.register("davinci-newton/util/GenericEvent.js",["./toName","./validName"],function(a,b){"use strict";var c,d,e;b&&b.id;return{setters:[function(a){c=a},function(a){d=a}],execute:function(){e=function(){function a(a,b,e){this.subject_=a,this.value_=e,this.name_=d["default"](c["default"](b))}return a.prototype.getName=function(a){return this.name_},a.prototype.getSubject=function(){return this.subject_},a}(),a("GenericEvent",e),a("default",e)}}}),System.register("davinci-newton/util/getSystemTime.js",[],function(a,b){"use strict";function c(){return.001*Date.now()}b&&b.id;return a("default",c),{setters:[],execute:function(){}}}),System.register("davinci-newton/runner/Clock.js",["../util/AbstractSubject","../util/GenericEvent","../util/getSystemTime"],function(a,b){"use strict";var c,d,e,f,g=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)};b&&b.id;return{setters:[function(a){c=a},function(a){d=a},function(a){e=a}],execute:function(){f=function(a){function b(b){void 0===b&&(b="CLOCK");var c=a.call(this,b)||this;return c.clockStart_sys_secs_=e["default"](),c.isRunning_=!1,c.saveTime_secs_=0,c.saveRealTime_secs_=0,c.stepMode_=!1,c.tasks_=[],c.timeRate_=1,c.realStart_sys_secs_=c.clockStart_sys_secs_,c}return g(b,a),b.prototype.clearStepMode=function(){this.stepMode_=!1},b.prototype.getTime=function(){return this.isRunning_?(e["default"]()-this.clockStart_sys_secs_)*this.timeRate_:this.saveTime_secs_},b.prototype.resume=function(){this.clearStepMode(),this.isRunning_||(this.isRunning_=!0,this.setTimePrivate(this.saveTime_secs_),this.setRealTime(this.saveRealTime_secs_),this.broadcast(new d["default"](this,b.CLOCK_RESUME)))},b.prototype.setTime=function(a){this.setTimePrivate(a),this.broadcast(new d["default"](this,b.CLOCK_SET_TIME))},b.prototype.setTimePrivate=function(a){this.isRunning_?(this.clockStart_sys_secs_=e["default"]()-a/this.timeRate_,this.scheduleAllClockTasks()):this.saveTime_secs_=a},b.prototype.scheduleAllClockTasks=function(){var a=this;this.tasks_.forEach(function(b){a.scheduleTask(b)})},b.prototype.scheduleTask=function(a){if(a.cancel(),this.isRunning_){var b=this.clockToSystem(this.getTime()),c=this.clockToSystem(a.getTime());c>=b&&a.schedule(c-b)}},b.prototype.setRealTime=function(a){this.isRunning_?this.realStart_sys_secs_=e["default"]()-a/this.timeRate_:this.saveRealTime_secs_=a},b.prototype.clockToSystem=function(a){return a/this.timeRate_+this.clockStart_sys_secs_},b}(c["default"]),f.CLOCK_RESUME="CLOCK_RESUME",f.CLOCK_SET_TIME="CLOCK_SET_TIME",a("Clock",f),a("default",f)}}}),System.register("davinci-newton/runner/SimRunner.js",["./Clock"],function(a,b){"use strict";var c,d;b&&b.id;return{setters:[function(a){c=a}],execute:function(){d=function(){function a(a,b){this.advanceStrategy_=a,this.clock_=new c["default"],this.timeStep_=a.getTimeStep()}return a.prototype.getClock=function(){return this.clock_},a.prototype.advanceToTargetTime=function(a,b){for(var c=a.getTime();c<b;){a.advance(this.timeStep_,this);var d=c;if(c=a.getTime(),c-d<=1e-15)throw new Error("SimRunner time did not advance")}},a.prototype.update=function(){var a=this.clock_.getTime(),b=this.advanceStrategy_.getTime();if(a>b+1||a<b-1){var c=b+this.timeStep_;this.clock_.setTime(c),this.clock_.setRealTime(c),a=c}var d=a,e=d-this.timeStep_/10;this.advanceToTargetTime(this.advanceStrategy_,e)},a.prototype.memorize=function(){},a}(),a("SimRunner",d),a("default",d)}}}),System.register("davinci-newton/util/toName.js",[],function(a,b){"use strict";function c(a){return a.toUpperCase().replace(/[ -]/g,"_")}b&&b.id;return a("default",c),{setters:[],execute:function(){}}}),System.register("davinci-newton/util/validName.js",[],function(a,b){"use strict";function c(a){if(!a.match(/^[A-Z_][A-Z_0-9]*$/))throw new Error("not a valid name: "+a);return a}b&&b.id;return a("default",c),{setters:[],execute:function(){}}}),System.register("davinci-newton/objects/AbstractSimObject.js",["../util/toName","../util/validName"],function(a,b){"use strict";var c,d,e;b&&b.id;return{setters:[function(a){c=a},function(a){d=a}],execute:function(){e=function(){function a(b){this.expireTime_=Number.POSITIVE_INFINITY,this.name_=d["default"](c["default"](b||"SIM_OBJ"+a.ID++))}return a.prototype.getExpireTime=function(){return this.expireTime_},a.prototype.getName=function(){return this.name_},a}(),e.ID=1,a("AbstractSimObject",e),a("default",e)}}}),System.register("davinci-newton/model/CoordType.js",[],function(a,b){"use strict";var c;b&&b.id;return{setters:[],execute:function(){!function(a){a[a.BODY=0]="BODY",a[a.WORLD=1]="WORLD"}(c||(c={})),a("CoordType",c),a("default",c)}}}),System.register("davinci-newton/model/Force.js",["../objects/AbstractSimObject","./CoordType"],function(a,b){"use strict";var c,d,e,f=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)};b&&b.id;return{setters:[function(a){c=a},function(a){d=a}],execute:function(){e=function(a){function b(b,c,d,e,f,g,h){void 0===h&&(h=0);var i=a.call(this,b)||this;return i.body_=c,i.location_=d,i.locationCoordType_=e,i.direction_=f,i.directionCoordType_=g,i.torque_=h,i}return f(b,a),b.prototype.getBody=function(){return this.body_},b.prototype.getVector=function(){return this.directionCoordType_===d["default"].BODY?this.body_.rotateBodyToWorld(this.direction_):this.direction_},b.prototype.getStartPoint=function(){return this.locationCoordType_===d["default"].BODY?this.body_.bodyToWorld(this.location_):this.location_},b.prototype.getEndPoint=function(){return this.getStartPoint().add(this.getVector())},b.prototype.getTorque=function(){return this.torque_},b.prototype.setExpireTime=function(a){throw new Error("TODO")},b}(c["default"]),a("Force",e),a("default",e)}}}),System.register("davinci-newton/objects/Spring.js",["./AbstractSimObject","../model/CoordType","../model/Force","../math/Vector"],function(a,b){"use strict";var c,d,e,f,g,h=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)};b&&b.id;return{setters:[function(a){c=a},function(a){d=a},function(a){e=a},function(a){f=a}],execute:function(){g=function(a){function b(b,c,d,e,f,g,h,i){void 0===h&&(h=0),void 0===i&&(i=!1);var j=a.call(this,b)||this;return j.body1_=c,j.attach1_=d,j.body2_=e,j.attach2_=f,j.restLength_=g,j.stiffness_=h,j.compressOnly_=i,j.damping_=0,j}return h(b,a),b.prototype.getStartPoint=function(){if(null==this.attach1_||null==this.body1_)throw new Error;return this.body1_.bodyToWorld(this.attach1_)},b.prototype.getEndPoint=function(){if(null==this.attach2_||null==this.body2_)throw new Error;var a=this.body2_.bodyToWorld(this.attach2_);if(this.compressOnly_){var b=this.getStartPoint(),c=b.distanceTo(a),d=this.restLength_;if(c<=d)return a;var e=a.subtract(b).normalize();return b.add(e.multiply(d))}return a},b.prototype.calculateForces=function(){var a=this.getStartPoint(),b=this.getEndPoint(),c=b.subtract(a),g=c.length(),h=-this.stiffness_*(g-this.restLength_),i=-h*(c.getX()/g),j=-h*(c.getY()/g),k=-h*(c.getZ()/g),l=new f["default"](i,j,k);if(0!==this.damping_&&(!this.compressOnly_||g<this.restLength_-1e-10)){var m=this.body1_.worldVelocityOfBodyPoint(this.attach1_),n=this.body2_.worldVelocityOfBodyPoint(this.attach2_),o=m.subtract(n).multiply(-this.damping_);l=l.add(o)}return[new e["default"]("spring",this.body1_,a,d["default"].WORLD,l,d["default"].WORLD),new e["default"]("spring",this.body2_,b,d["default"].WORLD,l.multiply(-1),d["default"].WORLD)]},b.prototype.disconnect=function(){},b.prototype.getPotentialEnergy=function(){return 0},b.prototype.getVector=function(){return this.getEndPoint().subtract(this.getStartPoint())},b}(c["default"]),a("Spring",g),a("default",g)}}}),System.register("davinci-newton/util/veryDifferent.js",[],function(a,b){"use strict";function c(a,b,c,d){if(void 0===c&&(c=1e-14),void 0===d&&(d=1),c<=0)throw new Error("epsilon ("+c+") must be positive.");if(d<=0)throw new Error("magnitude ("+d+") must be positive.");var e=Math.max(Math.abs(a),Math.abs(b)),f=e>d?e:d;return Math.abs(a-b)>f*c}b&&b.id;return a("default",c),{setters:[],execute:function(){}}}),System.register("davinci-newton/math/Vector.js",["../util/veryDifferent"],function(a,b){"use strict";var c,d;b&&b.id;return{setters:[function(a){c=a}],execute:function(){d=function(){function a(a,b,c){this.x_=a,this.y_=b,this.z_=c}return Object.defineProperty(a.prototype,"x",{get:function(){return this.x_},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"y",{get:function(){return this.y_},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"z",{get:function(){return this.z_},enumerable:!0,configurable:!0}),a.prototype.getX=function(){return this.x_},a.prototype.getY=function(){return this.y_},a.prototype.getZ=function(){return this.z_},a.prototype.add=function(a){throw new Error("TODO: add")},a.prototype.subtract=function(a){throw new Error("TODO: subtract")},a.prototype.multiply=function(a){throw new Error("TODO: multiply")},a.prototype.distanceTo=function(a){throw new Error("TODO: distanceTo")},a.prototype.immutable=function(){return this},a.prototype.length=function(){throw new Error("TODO: length")},a.prototype.nearEqual=function(a,b){return!c["default"](this.x_,a.getX(),b)&&(!c["default"](this.y_,a.getY(),b)&&!c["default"](this.z_,a.getZ(),b))},a.prototype.normalize=function(){throw new Error("TODO: normalize")},a.prototype.rotate=function(a,b){throw new Error("TODO: rotate")},a}(),d.ORIGIN=new d(0,0,0),a("Vector",d),a("default",d)}}}),System.register("davinci-newton.js",["./davinci-newton/config","./davinci-newton/engine/RigidBody","./davinci-newton/engine/RigidBodySim","./davinci-newton/model/RungeKutta","./davinci-newton/strategy/SimpleAdvance","./davinci-newton/runner/SimRunner","./davinci-newton/objects/Spring","./davinci-newton/math/Vector"],function(a,b){"use strict";var c,d,e,f,g,h,i,j,k;b&&b.id;return{setters:[function(a){c=a},function(a){d=a},function(a){e=a},function(a){f=a},function(a){g=a},function(a){h=a},function(a){i=a},function(a){j=a}],execute:function(){k={get LAST_MODIFIED(){return c["default"].LAST_MODIFIED},get VERSION(){return c["default"].VERSION},get RigidBody(){return d["default"]},get RigidBodySim(){return e["default"]},get RungeKutta(){return f["default"]},get SimpleAdvance(){return g["default"]},get SimRunner(){return h["default"]},get Spring(){return i["default"]},get Vector(){return j["default"]}},a("default",k)}}});